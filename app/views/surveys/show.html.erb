<%# btn retour %>
<% event = @survey.event %>
<%= link_to event_path(event) do %>
  <i class="fa-solid fa-circle-chevron-left"></i>
<% end %>

<%# titre %>
<h2 class="mb-5"><%= @survey.question %></h2>

<%# date limite %>
<div class="survey-content mb-4">
  <span class="title-bold">Date limite : </span>
  <span><%= @survey.deadline.strftime('%d/%m/%Y') %></span>
</div>

<%# Ã  vos votes %>
<% if @survey.deadline >= Date.today %>
  <h3 class="mb-3">A vos votes ğŸ“©</h3>
<% else %>
  <p  class="mb-3 title-bold">Sondage terminÃ© <i class="fa-solid fa-check text-success"></i></p>
<% end %>

<%# Affichage de la liste des rÃ©ponses %>
<div class="items-list">
  <% @survey.answers.each do |answer| %>
    <div class="item-avatar d-flex">
    <% if current_user.user_answers.exists?(answer_id: answer.id) %>
      <%= link_to answer.content, answer_user_answer_path(answer), class: "items done", data: {turbo_method: :delete} %>
    <% else %>
      <%= link_to answer.content, answer_user_answers_path(answer), class: "items", data: {turbo_method: :post} %>
    <% end %>
    <%# afficher l'avatar (voir pour en mettre pls) %>
        <% if answer.user_answers.first %>
          <% if answer.user_answers.first.user.avatar.attached? %>
            <%= image_tag url_for(answer.user_answers.first.user.avatar), class: "avatar" %>
          <% end %>
        <% end %>
    </div>
  <% end %>
</div>

<%# ajouter une option & petit valider %>
<% if @survey.deadline >= Date.today %>
  <%= simple_form_for [@survey, @answer] do |f| %>
    <div class="d-flex input-spacing align-items-start">
      <div class="d-flex btn-group w-100">
        <%= f.input :content,
            label: false,
            placeholder: "Option",
            as: :string,
            class: "custom-input-for-option input-spacing" %>
        <%= f.submit 'Valider', class: "validate-btn-small" %>
      </div>
    </div>
<% end %>

<%# valider la modification %>
  <div class="d-flex justify-content-center">
    <%= link_to "Valider", event_path(event), class: "d-flex justify-content-center validate-btn" %>
  </div>
<% end %>
